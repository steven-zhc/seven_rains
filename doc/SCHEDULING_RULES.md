# 七里河北控水务排班规则文档

# Seven Rain - Scheduling Rules Documentation

**项目**: Seven Rain Excel 排班工具  
**版本**: v0.2.0  
**更新时间**: 2025-09-09

---

## 📋 排班规则总览 (Scheduling Rules Overview)

### **排班规则 (按优先级排序)**

#### **规则 1: 每日值班覆盖 ⭐** (优先级: 110)

- 每天必须有且仅有一个人听班，包括周末
- 确保业务连续性和服务可用性

#### **规则 2：每人每周至少听班一次**（优先级：100）

#### **规则 3: 值班规则** (优先级: 90)

- **同一个人周一听班** → 周二休息，周三白班
- **同一个人周二听班** → 周三休息，周四白班
- **同一个人周三听班** → 周四休息，周五白班
- **同一个人周四听班** → 周五、周六、周日必须休息，下周一白班
- **同一个人周五听班** → 周六、周日、下周一休息,周二白班
- **同一个人周六听班** → 周日、下周一、周二休息，周三白班
- **同一个人周日听班** → 下周一、周二休息，周三白班

#### **规则 4: 避免重复排班** (优先级: 80)

- 不在连续周的同一天听班
- 防止某员工总是在同一工作日值班

---

## 📊 实际效果统计 (Current Statistics)

### **月度排班统计**

**2025 年 9 月排班结果** (6 名员工):

```
姚强:   值班5天, 休息15天, 工作15天
钱国祥: 值班3天, 休息11天, 工作21天
包汀池: 值班5天, 休息15天, 工作15天
孙震:   值班5天, 休息14天, 工作16天
夏银龙: 值班5天, 休息13天, 工作17天
张尧:   值班5天, 休息15天, 工作15天
```

**2025 年 10 月排班结果** (6 名员工):

```
姚强:   值班4天, 休息16天, 工作15天
钱国祥: 值班6天, 休息14天, 工作15天
包汀池: 值班5天, 休息13天, 工作17天
孙震:   值班5天, 休息17天, 工作13天
夏银龙: 值班8天, 休息19天, 工作8天
张尧:   值班7天, 休息16天, 工作12天
```

**员工变更**: 已移除赵兵，现有 6 名员工

**符号说明**:

- **听** - 值班日 (On-call duty)
- **休** - 休息日 (Rest day)
- **白** - 正常工作日 (Regular work day)

---

## ⚠️ 已知限制 (Known Limitations)

### **1. 跨月周处理 ✅**

- 已实现跨月周的完整处理
- 月份间规则连续性得到保证
- 存储系统支持跨月数据管理

### **2. 规则优先级冲突**

- 在员工数量有限时，某些高优先级规则可能导致其他规则难以满足
- 需要在规则严格性和实际可执行性间找到平衡

### **3. 工作负荷均衡**

- 由于休息规则的存在，某些员工可能承担更多值班任务
- 长期来看需要监控和调整以确保公平性

---

## 🔧 技术实现 (Technical Implementation)

### **系统架构**:

```python
# 员工配置 (当前6名员工)
EMPLOYEES = ["姚强", "钱国祥", "包汀池", "孙震", "夏银龙", "张尧"]

# 规则引擎 - 按优先级执行 (4条核心规则)
DEFAULT_RULES = [
    DailyOnCallCoverageRule(),       # 110 - 每日值班覆盖
    MinimumOnCallPerWeekRule(),      # 100 - 每人每周至少听班一次
    RestAfterOnCallRule(),           # 90  - 值班规则
    NoConsecutiveWeekdayRule(),      # 80  - 避免重复排班
]
```

### **调度流程**:

1. **数据加载**: 读取历史排班数据和规则配置
2. **周计划生成**: 按周为单位生成排班计划
3. **规则验证**: 按优先级顺序应用所有规则
4. **冲突解决**: 处理规则冲突并进行应急分配
5. **数据持久化**: 保存排班结果和元数据
6. **Excel 输出**: 生成格式化的排班表

---

## 📝 更新日志 (Change Log)

**v0.2.0 (2025-09-09)**:

- ✅ 新增每日值班覆盖规则（最高优先级）
- ✅ 移除员工赵兵，现有 6 名员工
- ✅ 修改每周值班限制：从 1 天改为最多 2 天
- ✅ 删除原"每周一次值班"规则，替换为"每周最多两次值班"规则
- ✅ 确保包括周末在内的每天都有值班覆盖

**v0.1.0 (2025-08-28)**:

- ✅ 实现 7 条核心排班规则
- ✅ 修复周末值班休息日冲突
- ✅ 添加员工统计功能
- ✅ 美化 Excel 表格主题
- ⚠️ 月末跨月处理待完善

---

## 🎯 规则执行优先级总览

| 优先级 | 规则名称             | 核心要求             | 影响范围 |
| ------ | -------------------- | -------------------- | -------- |
| 110    | 每日值班覆盖         | 每天必须有人值班     | 全局约束 |
| 100    | 每人每周至少听班一次 | 每人每周最少一次听班 | 周内约束 |
| 90     | 值班规则             | 详细的值班后休息安排 | 连续日期 |
| 80     | 避免重复排班         | 同一工作日不连续值班 | 跨周约束 |

---
